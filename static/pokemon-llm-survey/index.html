<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon LLM Survey</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fff5f5;
            color: #333;
            min-height: 100vh;
            padding: 1.5rem 1rem;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #ee1515;
            border-radius: 1rem;
            color: white;
            box-shadow: 0 4px 12px rgba(238, 21, 21, 0.2);
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .note {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.5rem;
        }

        .refusals {
            background: #f5f5f5;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-top: 1.5rem;
            font-size: 0.85rem;
            color: #666;
        }

        .refusals-title {
            font-weight: 600;
            color: #888;
            margin-bottom: 0.5rem;
        }

        .results {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .model-row {
            background: white;
            border-radius: 1rem;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border: 2px solid #f0f0f0;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .model-row:hover {
            border-color: #ee1515;
        }

        .model-row-header {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .model-row.expanded {
            border-color: #ee1515;
        }

        .explanations {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #f0f0f0;
        }

        .model-row.expanded .explanations {
            display: block;
        }

        .explanation {
            font-size: 0.85rem;
            color: #555;
            padding: 0.75rem;
            background: #fafafa;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }

        .explanation:last-child {
            margin-bottom: 0;
        }

        .chevron {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ccc;
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        .chevron::before {
            content: '';
            width: 10px;
            height: 10px;
            border-right: 2px solid currentColor;
            border-bottom: 2px solid currentColor;
            transform: rotate(45deg);
            margin-top: -4px;
        }

        .model-row.expanded .chevron::before {
            transform: rotate(-135deg);
            margin-top: 4px;
        }

        .model-row:hover .chevron {
            color: #ee1515;
        }

        .sprite-container {
            width: 72px;
            height: 72px;
            background: #f8f8f8;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .sprite {
            width: 64px;
            height: 64px;
            image-rendering: pixelated;
        }

        .info {
            flex: 1;
            min-width: 0;
        }

        .model-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }

        .pokemon-name {
            font-size: 0.9rem;
            text-transform: capitalize;
            color: #888;
        }

        .percentage {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ee1515;
            text-align: right;
        }

        .loading, .error {
            text-align: center;
            padding: 3rem 1rem;
            color: #888;
        }

        .provider-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #aaa;
            margin-top: 0.5rem;
        }

        footer {
            text-align: center;
            margin-top: 2rem;
            padding: 1rem;
            font-size: 0.8rem;
            color: #aaa;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Pokemon LLM Survey</h1>
            <p class="subtitle">Which Pokemon do AI models identify with?</p>
            <p class="note">Each model was asked 20 times. Percentage shows how often they chose their top pick.</p>
        </header>

        <main class="results" id="results">
            <div class="loading">Loading...</div>
        </main>

        <footer id="footer"></footer>
    </div>

    <script>
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function renderMarkdown(text) {
            let html = escapeHtml(text);
            // Bold: **text** or __text__
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/__(.+?)__/g, '<strong>$1</strong>');
            // Italic: *text* or _text_
            html = html.replace(/\*([^*]+)\*/g, '<em>$1</em>');
            html = html.replace(/_([^_]+)_/g, '<em>$1</em>');
            // Line breaks
            html = html.replace(/\n/g, '<br>');
            return html;
        }

        async function fetchSprite(name) {
            try {
                const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${name.toLowerCase()}`);
                if (!res.ok) return null;
                const data = await res.json();
                return data.sprites.front_default;
            } catch {
                return null;
            }
        }

        async function load() {
            const results = document.getElementById('results');
            const footer = document.getElementById('footer');

            try {
                const res = await fetch('data.json');
                if (!res.ok) throw new Error('No data');
                const data = await res.json();

                if (!data.responses?.length) {
                    results.innerHTML = '<div class="loading">No data yet. Run collect.py first.</div>';
                    return;
                }

                // Aggregate by model
                const byModel = {};
                for (const r of data.responses) {
                    const name = r.model_name || r.model;
                    if (!byModel[name]) byModel[name] = { total: 0, pokemon: {} };
                    byModel[name].total++;
                    const p = r.pokemon || 'unknown';
                    byModel[name].pokemon[p] = (byModel[name].pokemon[p] || 0) + 1;
                }

                // Get top pokemon per model with provider and sample explanations
                const rows = [];
                const refusals = [];
                for (const [model, info] of Object.entries(byModel)) {
                    const sorted = Object.entries(info.pokemon).sort((a, b) => b[1] - a[1]);
                    const [topPokemon, count] = sorted[0];
                    const pct = Math.round((count / info.total) * 100);

                    // Track models that mostly refused
                    if (topPokemon === 'unknown') {
                        refusals.push(model);
                        continue;
                    }

                    // Get sample explanations (up to 3 responses for the top pokemon)
                    const explanations = data.responses
                        .filter(r => (r.model_name || r.model) === model && r.pokemon === topPokemon)
                        .slice(0, 1)
                        .map(r => r.raw_response);

                    const sample = data.responses.find(r => (r.model_name || r.model) === model);
                    const provider = sample?.provider || 'unknown';
                    rows.push({ model, pokemon: topPokemon, pct, total: info.total, provider, explanations });
                }

                // Detect lab from model name
                const labMap = {
                    'claude': 'Anthropic',
                    'opus': 'Anthropic',
                    'sonnet': 'Anthropic',
                    'haiku': 'Anthropic',
                    'gpt': 'OpenAI',
                    'o1': 'OpenAI',
                    'gemini': 'Google',
                    'mistral': 'Mistral',
                    'llama': 'Meta',
                    'deepseek': 'DeepSeek',
                    'qwen': 'Qwen',
                    'grok': 'xAI',
                    'kimi': 'Moonshot',
                };

                function getLab(modelName) {
                    const lower = modelName.toLowerCase();
                    for (const [key, lab] of Object.entries(labMap)) {
                        if (lower.includes(key)) return lab;
                    }
                    return 'Other';
                }

                // Group by lab
                const byLab = {};
                for (const row of rows) {
                    const lab = getLab(row.model);
                    if (!byLab[lab]) byLab[lab] = [];
                    byLab[lab].push(row);
                }

                // Lab order
                const labOrder = ['Anthropic', 'OpenAI', 'Google', 'Meta', 'Mistral', 'DeepSeek', 'Qwen', 'xAI', 'Moonshot', 'Other'];

                results.innerHTML = '';

                for (const lab of labOrder) {
                    const labRows = byLab[lab];
                    if (!labRows || labRows.length === 0) continue;

                    const label = document.createElement('div');
                    label.className = 'provider-label';
                    label.textContent = lab;
                    results.appendChild(label);

                    for (const row of labRows) {
                    const div = document.createElement('div');
                    div.className = 'model-row';

                    const explanationsHtml = row.explanations
                        .map(e => `<div class="explanation">${renderMarkdown(e)}</div>`)
                        .join('');

                    div.innerHTML = `
                        <div class="model-row-header">
                            <div class="sprite-container" data-pokemon="${row.pokemon}">
                                <div style="color:#ccc;font-size:1.5rem">?</div>
                            </div>
                            <div class="info">
                                <div class="model-name">${row.model}</div>
                                <div class="pokemon-name">${row.pokemon}</div>
                            </div>
                            <div class="percentage">${row.pct}%</div>
                            <div class="chevron"></div>
                        </div>
                        <div class="explanations">${explanationsHtml}</div>
                    `;

                    div.addEventListener('click', () => {
                        const wasExpanded = div.classList.contains('expanded');
                        // Collapse all others
                        document.querySelectorAll('.model-row.expanded').forEach(el => {
                            el.classList.remove('expanded');
                        });
                        // Toggle this one (if it wasn't expanded, expand it)
                        if (!wasExpanded) div.classList.add('expanded');
                    });

                    results.appendChild(div);

                    // Load sprite async
                    if (row.pokemon !== 'unknown') {
                        fetchSprite(row.pokemon).then(url => {
                            if (url) {
                                div.querySelector('.sprite-container').innerHTML =
                                    `<img class="sprite" src="${url}" alt="${row.pokemon}">`;
                            }
                        });
                    }
                    }
                }

                // Show models that refused
                if (refusals.length > 0) {
                    const refusalDiv = document.createElement('div');
                    refusalDiv.className = 'refusals';
                    refusalDiv.innerHTML = `
                        <div class="refusals-title">Models that declined to choose:</div>
                        ${refusals.join(', ')}
                    `;
                    results.appendChild(refusalDiv);
                }

                footer.textContent = `${data.responses.length} responses from ${Object.keys(byModel).length} models`;

            } catch (e) {
                results.innerHTML = '<div class="error">Could not load data.json</div>';
            }
        }

        load();
    </script>
</body>
</html>
